## Synchro Reminder SDK

This SDK lets your app react to **upcoming renewal reminders** generated by the Synchro backend.

### Capabilities

- **Subscribe to renewal notifications** dispatched via Web Push.
- Receive **daily reminder events** as the reminder engine runs.
- Event payload includes **subscription ID** and **due date (renewal date)**.
- Simple **event-driven API**:
  - Low-level: `onReminder(callback)`
  - React: `useReminderListener()`

### 1. Service Worker Setup

The backend already sends Web Push notifications with renewal metadata. The SDK uses a dedicated service worker to listen for those and forward structured events to your app.

Service worker file (already added):

- `public/reminder-sw.js`

It:

- Listens for `push` events.
- Shows a browser notification.
- Sends a `postMessage` with a `ReminderEvent` to all open windows.

### 2. Low-level API (`lib/reminder-listener.ts`)

**Register the service worker:**

```ts
import { registerReminderServiceWorker } from "@/lib/reminder-listener";

await registerReminderServiceWorker(); // default: "/reminder-sw.js"
```

**Subscribe to reminders:**

```ts
import { onReminder } from "@/lib/reminder-listener";

const unsubscribe = onReminder((event) => {
  console.log("Upcoming renewal:", event.subscriptionId, event.renewalDate);
});

// Later, to stop listening:
unsubscribe();
```

`event` has the shape:

```ts
interface ReminderEvent {
  subscriptionId: string;
  renewalDate: string; // ISO date string
  reminderType: "renewal" | "trial_expiry" | "cancellation";
  url?: string;
}
```

### 3. React Hook (`hooks/use-reminder-listener.ts`)

For React apps:

```ts
"use client";

import { useReminderListener } from "@/hooks/use-reminder-listener";

export function RenewalBanner() {
  const { lastReminder, reminders, isSupported, error } = useReminderListener();

  if (!isSupported) return null;
  if (error) return <div>Error: {error}</div>;
  if (!lastReminder) return null;

  return (
    <div>
      Subscription {lastReminder.subscriptionId} renews on{" "}
      {new Date(lastReminder.renewalDate).toLocaleDateString()}
    </div>
  );
}
```

The hook:

- Registers the reminder service worker on mount.
- Subscribes to reminder events.
- Exposes:
  - `lastReminder` – most recent event.
  - `reminders` – all events seen in this session.
  - `isSupported` – whether service workers are available.
  - `error` – initialization errors, if any.

### 4. Backend Integration Notes

- The backend `pushService` already embeds `subscriptionId`, `reminderType`, and `renewalDate` in the push payload.
- The service worker filters for `reminderType === "renewal"` to match the current SDK contract.
- As long as your environment has:
  - Web Push configured (VAPID keys).
  - A running reminder engine.

The SDK will surface a **daily stream of renewal events** to your app.

